{"source":"webpackJsonp([17],{1305:function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=t(262),d=t.n(n),a=t(265),o=t.n(a),u=t(95),m=t(1391),v=t(508);function i(e,r){var t={};for(var n in e)0<=r.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}r.default={namespace:\"project-users\",state:{roles:void 0,pageSize:20,list:[],page:1,total:void 0,loading:!1,info:void 0,role:void 0,saving:!1},subscriptions:{setup:function(e){var s=e.dispatch;return e.history.listen(function(e){var r=e.pathname,t=e.search,n=r.match(/^\\/projects\\/([\\w-]+)\\/users$/);if(n)return s({type:\"init\",payload:{projectName:n[1],search:t}});var a=r.match(/^\\/projects\\/([\\w-]+)\\/users\\/([\\w-]+)$/);return a&&\"add\"!==a[2]?s({type:\"getUserInfo\",payload:{projectName:n[1],username:n[2]}}):void 0})}},effects:{init:d.a.mark(function e(r,t){var n,a,s=r.payload,c=t.put;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.a.parse(s.search),a=parseInt(n.page||1,10),e.next=4,c({type:\"save\",payload:{page:a,list:[],total:void 0}});case 4:return e.next=6,c({type:\"getUserRoles\",payload:s});case 6:return e.next=8,c({type:\"load\",payload:s});case 8:case\"end\":return e.stop()}},e,this)}),getUserRoles:d.a.mark(function e(r,t){var n,a,s,c,o,u=r.payload,p=t.call,i=t.put,f=t.select;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(function(e){return e[\"project-users\"]});case 2:if(n=e.sent,!((a=n.roles)&&0<a.length&&u.projectName===a[0].project_name)){e.next=6;break}return e.abrupt(\"return\");case 6:return e.next=8,i({type:\"save\",payload:{roles:void 0}});case 8:return e.next=10,p(m.a.getProjectUserRoles,{projectName:u.projectName});case 10:return s=e.sent,c=s.data,o=s.errMsg,e.next=15,i({type:\"save\",payload:{roles:c||null}});case 15:if(!o){e.next=19;break}Object(v.c)(o,\"获取用户角色列表失败\"),e.next=21;break;case 19:return e.next=21,i({type:\"mergeUserRoles\"});case 21:case\"end\":return e.stop()}},e,this)}),load:d.a.mark(function e(r,t){var n,a,s,c,o,u,p=r.payload,i=t.call,f=t.put,l=t.select;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(function(e){return e[\"project-users\"]});case 2:if(n=e.sent,a=n.page,s=n.pageSize,!n.loading){e.next=8;break}return e.abrupt(\"return\");case 8:return e.next=10,f({type:\"save\",payload:{loading:!0}});case 10:return e.next=12,i(m.a.getProjectUsers,{start:(a-1)*s,limit:s,projectName:p.projectName});case 12:return c=e.sent,o=c.data,u=c.errMsg,e.next=17,f({type:\"save\",payload:{loading:!1,list:o&&o.list||null,total:o&&o.total}});case 17:if(!u){e.next=21;break}Object(v.c)(u,\"获取用户列表失败\"),e.next=23;break;case 21:return e.next=23,f({type:\"mergeUserRoles\"});case 23:case\"end\":return e.stop()}},e,this)}),mergeUserRoles:d.a.mark(function e(r,t){r.payload;var n,a,s,c=t.put,o=t.select;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(function(e){return e[\"project-users\"]});case 2:if(n=e.sent,a=n.roles,s=n.list,a&&s&&0!==a.length&&0!==s.length){e.next=7;break}return e.abrupt(\"return\");case 7:return e.next=9,c({type:\"save\",payload:{list:s.map(function(r){var e=a.find(function(e){return e.username===r.username});return Object.assign({},r,{role:e&&e.role})})}});case 9:case\"end\":return e.stop()}},e,this)}),getUserInfo:d.a.mark(function e(r,t){var n,a,s,c=r.payload,o=t.put,u=t.select;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(function(e){return e.projects});case 2:if(n=e.sent,a=n.info,s=n.role,a&&c.username===a.username){e.next=8;break}return e.next=8,o({type:\"refreshProjectInfo\",payload:c});case 8:if(s&&c.projectName===s.projectName&&c.username===s.username){e.next=11;break}return e.next=11,o({type:\"refreshUserRole\",payload:c});case 11:case\"end\":return e.stop()}},e,this)}),refreshUserInfo:d.a.mark(function e(r,t){var n,a,s=r.payload,c=t.call,o=t.put;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({type:\"save\",payload:{info:void 0}});case 2:return e.next=4,c(m.a.getProjectUserInfo,s);case 4:return n=e.sent,a=n.data,e.next=8,o({type:\"save\",payload:{info:a||null}});case 8:case\"end\":return e.stop()}},e,this)}),refreshUserRole:d.a.mark(function e(r,t){var n,a,s=r.payload,c=t.call,o=t.put;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({type:\"save\",payload:{role:void 0}});case 2:return e.next=4,c(m.a.getProjectUserRole,s);case 4:return n=e.sent,a=n.data,e.next=8,o({type:\"save\",payload:{role:a||null}});case 8:case\"end\":return e.stop()}},e,this)}),saveUserInfo:d.a.mark(function e(r,t){var n,a,s=r.payload,c=t.put,o=t.call;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({type:\"save\",payload:{saving:!0}});case 2:return e.next=4,o(m.a.updateProjectInfo,s);case 4:return n=e.sent,a=n.errMsg,e.next=8,c({type:\"save\",payload:{saving:!1}});case 8:if(!a){e.next=12;break}Object(v.c)(a,\"修改商户信息失败\"),e.next=15;break;case 12:return e.next=14,c({type:\"saveProjectInfo\",payload:s});case 14:u.F.success({message:\"修改录像信息成功\"});case 15:case\"end\":return e.stop()}},e,this)}),updateUserInfo:d.a.mark(function e(r,t){var n,a,s,c,o=r.payload,u=t.put,p=t.select;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(function(e){return e.projects});case 2:if(n=e.sent,a=n.info,s=o.projectName,c=i(o,[\"projectName\"]),!a||s!==a.name){e.next=8;break}return e.next=8,u({type:\"save\",payload:{info:Object.assign({},a,c)}});case 8:case\"end\":return e.stop()}},e,this)})},reducers:{save:function(e,r){return Object.assign({},e,r.payload)}}}},1391:function(e,r,t){\"use strict\";var n=t(262),s=t.n(n),a=t(507);function c(e,r){var t={};for(var n in e)0<=r.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function o(e){return function(){var o=e.apply(this,arguments);return new Promise(function(s,c){return function r(e,t){try{var n=o[e](t),a=n.value}catch(e){return void c(e)}if(!n.done)return Promise.resolve(a).then(function(e){r(\"next\",e)},function(e){r(\"throw\",e)});s(a)}(\"next\")})}}var u,p,i,f,l,d,m,v,h,y,j,x,g,w,b,N,k,P=function(){return Object(a.a)(\"/projects/:projectName/:resourcetype/:resourceId/:subType/:subId\")};r.a={addVirtualCamera:(k=o(s.a.mark(function e(r){var t=r.projectName,n=c(r,[\"projectName\"]);return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().post({projectName:t,resourcetype:\"add_virtual_camera\"},n));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)}),getStorageQuota:(N=o(s.a.mark(function e(r){var t=r.projectName;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"storage_quota\"}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return N.apply(this,arguments)}),getProjects:(b=o(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get(r));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)}),getProjectInfo:(w=o(s.a.mark(function e(r){var t=r.projectName;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)}),updateProjectInfo:(g=o(s.a.mark(function e(r){var t=r.projectName,n=c(r,[\"projectName\"]);return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().put({projectName:t},n));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)}),getAccount:(x=o(s.a.mark(function e(r){var t=r.projectName;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"account\"}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)}),getQuota:(j=o(s.a.mark(function e(r){var t=r.projectName;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"quota\"}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)}),getOnlineSchoolConfig:(y=o(s.a.mark(function e(r){var t=r.projectName;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"online_school\",resourceId:\"config\"}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)}),getWechatMerchant:(h=o(s.a.mark(function e(r){var t=r.projectName;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"wechat_merchant\"}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)}),getProjectUsers:(v=o(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get(Object.assign({},r,{resourcetype:\"users\"})));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)}),getProjectUserInfo:(m=o(s.a.mark(function e(r){var t=r.projectName,n=r.username;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"users\",resourceId:n}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)}),addProjectUser:(d=o(s.a.mark(function e(r){var t=r.projectName,n=r.username,a=r.role;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().post({projectName:t,resourcetype:\"users\"},{username:n,role:a}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)}),removeProjectUser:(l=o(s.a.mark(function e(r){var t=r.projectName,n=r.username;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().remove({projectName:t,resourcetype:\"users\",resourceId:n}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)}),getProjectUserRoles:(f=o(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get(Object.assign({},r,{resourcetype:\"user_roles\"})));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)}),getProjectUserRole:(i=o(s.a.mark(function e(r){var t=r.projectName,n=r.username;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get({projectName:t,resourcetype:\"user_roles\",resourceId:n}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)}),updateProjectUserRole:(p=o(s.a.mark(function e(r){var t=r.projectName,n=r.username,a=r.role;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().put({projectName:t,resourcetype:\"user_roles\",resourceId:n},{role:a}));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)}),getProjectDevices:(u=o(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",P().get(Object.assign({},r,{resourcetype:\"devices\"})));case 1:case\"end\":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})}}});"}