webpackJsonp([17],{1305:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(262),a=t.n(n),s=t(265),u=t.n(s),c=t(95),o=t(1391),p=t(508);function i(e,r){var t={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}r.default={namespace:"project-users",state:{roles:void 0,pageSize:20,list:[],page:1,total:void 0,loading:!1,info:void 0,role:void 0,saving:!1},subscriptions:{setup:function(e){var r=e.dispatch;return e.history.listen(function(e){var t=e.pathname,n=e.search,a=t.match(/^\/projects\/([\w-]+)\/users$/);if(a)return r({type:"init",payload:{projectName:a[1],search:n}});var s=t.match(/^\/projects\/([\w-]+)\/users\/([\w-]+)$/);return s&&"add"!==s[2]?r({type:"getUserInfo",payload:{projectName:a[1],username:a[2]}}):void 0})}},effects:{init:a.a.mark(function e(r,t){var n,s,c=r.payload,o=t.put;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.a.parse(c.search),s=parseInt(n.page||1,10),e.next=4,o({type:"save",payload:{page:s,list:[],total:void 0}});case 4:return e.next=6,o({type:"getUserRoles",payload:c});case 6:return e.next=8,o({type:"load",payload:c});case 8:case"end":return e.stop()}},e,this)}),getUserRoles:a.a.mark(function e(r,t){var n,s,u,c,i,f=r.payload,l=t.call,v=t.put,d=t.select;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(function(e){return e["project-users"]});case 2:if(n=e.sent,!((s=n.roles)&&0<s.length&&f.projectName===s[0].project_name)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,v({type:"save",payload:{roles:void 0}});case 8:return e.next=10,l(o.a.getProjectUserRoles,{projectName:f.projectName});case 10:return u=e.sent,c=u.data,i=u.errMsg,e.next=15,v({type:"save",payload:{roles:c||null}});case 15:if(!i){e.next=19;break}Object(p.c)(i,"\u83b7\u53d6\u7528\u6237\u89d2\u8272\u5217\u8868\u5931\u8d25"),e.next=21;break;case 19:return e.next=21,v({type:"mergeUserRoles"});case 21:case"end":return e.stop()}},e,this)}),load:a.a.mark(function e(r,t){var n,s,u,c,i,f,l=r.payload,v=t.call,d=t.put,m=t.select;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(function(e){return e["project-users"]});case 2:if(n=e.sent,s=n.page,u=n.pageSize,!n.loading){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,d({type:"save",payload:{loading:!0}});case 10:return e.next=12,v(o.a.getProjectUsers,{start:(s-1)*u,limit:u,projectName:l.projectName});case 12:return c=e.sent,i=c.data,f=c.errMsg,e.next=17,d({type:"save",payload:{loading:!1,list:i&&i.list||null,total:i&&i.total}});case 17:if(!f){e.next=21;break}Object(p.c)(f,"\u83b7\u53d6\u7528\u6237\u5217\u8868\u5931\u8d25"),e.next=23;break;case 21:return e.next=23,d({type:"mergeUserRoles"});case 23:case"end":return e.stop()}},e,this)}),mergeUserRoles:a.a.mark(function e(r,t){r.payload;var n,s,u,c=t.put,o=t.select;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(function(e){return e["project-users"]});case 2:if(n=e.sent,s=n.roles,u=n.list,s&&u&&0!==s.length&&0!==u.length){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,c({type:"save",payload:{list:u.map(function(e){var r=s.find(function(r){return r.username===e.username});return Object.assign({},e,{role:r&&r.role})})}});case 9:case"end":return e.stop()}},e,this)}),getUserInfo:a.a.mark(function e(r,t){var n,s,u,c=r.payload,o=t.put,p=t.select;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(function(e){return e.projects});case 2:if(n=e.sent,s=n.info,u=n.role,s&&c.username===s.username){e.next=8;break}return e.next=8,o({type:"refreshProjectInfo",payload:c});case 8:if(u&&c.projectName===u.projectName&&c.username===u.username){e.next=11;break}return e.next=11,o({type:"refreshUserRole",payload:c});case 11:case"end":return e.stop()}},e,this)}),refreshUserInfo:a.a.mark(function e(r,t){var n,s,u=r.payload,c=t.call,p=t.put;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({type:"save",payload:{info:void 0}});case 2:return e.next=4,c(o.a.getProjectUserInfo,u);case 4:return n=e.sent,s=n.data,e.next=8,p({type:"save",payload:{info:s||null}});case 8:case"end":return e.stop()}},e,this)}),refreshUserRole:a.a.mark(function e(r,t){var n,s,u=r.payload,c=t.call,p=t.put;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({type:"save",payload:{role:void 0}});case 2:return e.next=4,c(o.a.getProjectUserRole,u);case 4:return n=e.sent,s=n.data,e.next=8,p({type:"save",payload:{role:s||null}});case 8:case"end":return e.stop()}},e,this)}),saveUserInfo:a.a.mark(function e(r,t){var n,s,u=r.payload,i=t.put,f=t.call;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({type:"save",payload:{saving:!0}});case 2:return e.next=4,f(o.a.updateProjectInfo,u);case 4:return n=e.sent,s=n.errMsg,e.next=8,i({type:"save",payload:{saving:!1}});case 8:if(!s){e.next=12;break}Object(p.c)(s,"\u4fee\u6539\u5546\u6237\u4fe1\u606f\u5931\u8d25"),e.next=15;break;case 12:return e.next=14,i({type:"saveProjectInfo",payload:u});case 14:c.F.success({message:"\u4fee\u6539\u5f55\u50cf\u4fe1\u606f\u6210\u529f"});case 15:case"end":return e.stop()}},e,this)}),updateUserInfo:a.a.mark(function e(r,t){var n,s,u,c,o=r.payload,p=t.put,f=t.select;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(function(e){return e.projects});case 2:if(n=e.sent,s=n.info,u=o.projectName,c=i(o,["projectName"]),!s||u!==s.name){e.next=8;break}return e.next=8,p({type:"save",payload:{info:Object.assign({},s,c)}});case 8:case"end":return e.stop()}},e,this)})},reducers:{save:function(e,r){return Object.assign({},e,r.payload)}}}},1391:function(e,r,t){"use strict";var n=t(262),a=t.n(n),s=t(507);function u(e,r){var t={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function c(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function n(a,s){try{var u=r[a](s),c=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}var o=function(){return Object(s.a)("/projects/:projectName/:resourcetype/:resourceId/:subType/:subId")};r.a={addVirtualCamera:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=u(r,["projectName"]);return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().post({projectName:t,resourcetype:"add_virtual_camera"},n));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getStorageQuota:function(){var e=c(a.a.mark(function e(r){var t=r.projectName;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"storage_quota"}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjects:function(){var e=c(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get(r));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjectInfo:function(){var e=c(a.a.mark(function e(r){var t=r.projectName;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),updateProjectInfo:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=u(r,["projectName"]);return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().put({projectName:t},n));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getAccount:function(){var e=c(a.a.mark(function e(r){var t=r.projectName;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"account"}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getQuota:function(){var e=c(a.a.mark(function e(r){var t=r.projectName;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"quota"}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getOnlineSchoolConfig:function(){var e=c(a.a.mark(function e(r){var t=r.projectName;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"online_school",resourceId:"config"}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getWechatMerchant:function(){var e=c(a.a.mark(function e(r){var t=r.projectName;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"wechat_merchant"}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjectUsers:function(){var e=c(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get(Object.assign({},r,{resourcetype:"users"})));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjectUserInfo:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=r.username;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"users",resourceId:n}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),addProjectUser:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=r.username,s=r.role;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().post({projectName:t,resourcetype:"users"},{username:n,role:s}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),removeProjectUser:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=r.username;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().remove({projectName:t,resourcetype:"users",resourceId:n}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjectUserRoles:function(){var e=c(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get(Object.assign({},r,{resourcetype:"user_roles"})));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjectUserRole:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=r.username;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get({projectName:t,resourcetype:"user_roles",resourceId:n}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),updateProjectUserRole:function(){var e=c(a.a.mark(function e(r){var t=r.projectName,n=r.username,s=r.role;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().put({projectName:t,resourcetype:"user_roles",resourceId:n},{role:s}));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}(),getProjectDevices:function(){var e=c(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o().get(Object.assign({},r,{resourcetype:"devices"})));case 1:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}()}}});
//# sourceMappingURL=17.b33a54ba.chunk.js.map